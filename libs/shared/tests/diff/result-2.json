{
    "files": {
        "scrapy/extensions/feedexport.py": {
            "segments": [
                {
                    "header": [
                        "140",
                        "6",
                        "140",
                        "8"
                    ],
                    "lines": [
                        {
                            "builds": [],
                            "source": "",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": null,
                            "line": "140"
                        },
                        {
                            "builds": [],
                            "source": "    def __init__(self, settings):",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "141"
                        },
                        {
                            "builds": [],
                            "source": "        self.settings = settings",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "142"
                        },
                        {
                            "builds": [],
                            "source": "        self.indexfmt = '{:05d}'",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "143"
                        },
                        {
                            "builds": [],
                            "source": "        self.index = 1",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "144"
                        },
                        {
                            "builds": [],
                            "source": "        self.urifmt = settings['FEED_URI']",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "145"
                        },
                        {
                            "builds": [],
                            "source": "        if not self.urifmt:",
                            "coverage": "2/2",
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "146"
                        },
                        {
                            "builds": [],
                            "source": "            raise NotConfigured",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "147"
                        }
                    ]
                },
                {
                    "header": [
                        "154",
                        "6",
                        "156",
                        "8"
                    ],
                    "lines": [
                        {
                            "builds": [],
                            "source": "        self.export_fields = settings.getlist('FEED_EXPORT_FIELDS') or None",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "156"
                        },
                        {
                            "builds": [],
                            "source": "        uripar = settings['FEED_URI_PARAMS']",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "157"
                        },
                        {
                            "builds": [],
                            "source": "        self._uripar = load_object(uripar) if uripar else lambda x, y: None",
                            "coverage": "2/2",
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "158"
                        },
                        {
                            "builds": [],
                            "source": "        self.batch_size = settings['FEED_BATCH_SIZE']",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "159"
                        },
                        {
                            "builds": [],
                            "source": "        self.start = datetime.utcnow().replace(microsecond=0).isoformat().replace(':', '-')",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "160"
                        },
                        {
                            "builds": [],
                            "source": "",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": null,
                            "line": "161"
                        },
                        {
                            "builds": [],
                            "source": "    @classmethod",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "162"
                        },
                        {
                            "builds": [],
                            "source": "    def from_crawler(cls, crawler):",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": null,
                            "line": "163"
                        }
                    ]
                },
                {
                    "header": [
                        "164",
                        "34",
                        "168",
                        "21"
                    ],
                    "lines": [
                        {
                            "builds": [],
                            "source": "        return o",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "168"
                        },
                        {
                            "builds": [],
                            "source": "",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": null,
                            "line": "169"
                        },
                        {
                            "builds": [],
                            "source": "    def open_spider(self, spider):",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "170"
                        },
                        {
                            "builds": [],
                            "source": "        uri = self.urifmt % self._get_uri_params(spider)",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "171"
                        },
                        {
                            "builds": [],
                            "source": "        storage = self._get_storage(uri)",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "172"
                        },
                        {
                            "builds": [],
                            "source": "        file = storage.open(spider)",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "173"
                        },
                        {
                            "builds": [],
                            "source": "        exporter = self._get_exporter(file, fields_to_export=self.export_fields)",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "174"
                        },
                        {
                            "builds": [],
                            "source": "        exporter.start_exporting()",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "175"
                        },
                        {
                            "builds": [],
                            "source": "        self.slot = SpiderSlot(file, exporter, storage, uri)",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "176"
                        },
                        {
                            "builds": [],
                            "source": "        self._start_export(spider)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "171"
                        },
                        {
                            "builds": [],
                            "source": "",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": null,
                            "line": "172"
                        },
                        {
                            "builds": [],
                            "source": "    def close_spider(self, spider):",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "173"
                        },
                        {
                            "builds": [],
                            "source": "        slot = self.slot",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "180"
                        },
                        {
                            "builds": [],
                            "source": "        if not slot.itemcount and not self.store_empty:",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "181"
                        },
                        {
                            "builds": [],
                            "source": "            return",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "182"
                        },
                        {
                            "builds": [],
                            "source": "        slot.exporter.finish_exporting()",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "183"
                        },
                        {
                            "builds": [],
                            "source": "        logfmt = \"%s %%(format)s feed (%%(itemcount)d items) in: %%(uri)s\"",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "184"
                        },
                        {
                            "builds": [],
                            "source": "        log_args = {'format': self.format,",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "185"
                        },
                        {
                            "builds": [],
                            "source": "                    'itemcount': slot.itemcount,",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "186"
                        },
                        {
                            "builds": [],
                            "source": "                    'uri': slot.uri}",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "187"
                        },
                        {
                            "builds": [],
                            "source": "        d = defer.maybeDeferred(slot.storage.store, slot.file)",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "188"
                        },
                        {
                            "builds": [],
                            "source": "        d.addCallback(lambda _: logger.info(logfmt % \"Stored\", log_args,",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "189"
                        },
                        {
                            "builds": [],
                            "source": "                                            extra={'spider': spider}))",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "190"
                        },
                        {
                            "builds": [],
                            "source": "        d.addErrback(lambda f: logger.error(logfmt % \"Error storing\", log_args,",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "191"
                        },
                        {
                            "builds": [],
                            "source": "                                            exc_info=failure_to_exc_info(f),",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "192"
                        },
                        {
                            "builds": [],
                            "source": "                                            extra={'spider': spider}))",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "193"
                        },
                        {
                            "builds": [],
                            "source": "        return d",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "removed",
                            "line": "194"
                        },
                        {
                            "builds": [],
                            "source": "        self._export(spider)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "174"
                        },
                        {
                            "builds": [],
                            "source": "",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": null,
                            "line": "175"
                        },
                        {
                            "builds": [],
                            "source": "    def item_scraped(self, item, spider):",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "176"
                        },
                        {
                            "builds": [],
                            "source": "        slot = self.slot",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "177"
                        },
                        {
                            "builds": [],
                            "source": "        slot.exporter.export_item(item)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "178"
                        },
                        {
                            "builds": [],
                            "source": "        slot.itemcount += 1",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "179"
                        },
                        {
                            "builds": [],
                            "source": "        # Export batch feed",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "added",
                            "line": "180"
                        },
                        {
                            "builds": [],
                            "source": "        if self.batch_size and slot.itemcount == self.batch_size:",
                            "coverage": "2/2",
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "181"
                        },
                        {
                            "builds": [],
                            "source": "            # Export",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "added",
                            "line": "182"
                        },
                        {
                            "builds": [],
                            "source": "            self._export(spider)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "183"
                        },
                        {
                            "builds": [],
                            "source": "            # Next export",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "added",
                            "line": "184"
                        },
                        {
                            "builds": [],
                            "source": "            self._start_export(spider)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "185"
                        },
                        {
                            "builds": [],
                            "source": "        return item",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "186"
                        },
                        {
                            "builds": [],
                            "source": "",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": null,
                            "line": "187"
                        },
                        {
                            "builds": [],
                            "source": "    def _load_components(self, setting_prefix):",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "188"
                        }
                    ]
                },
                {
                    "header": [
                        "235",
                        "5",
                        "226",
                        "35"
                    ],
                    "lines": [
                        {
                            "builds": [],
                            "source": "            params[k] = getattr(spider, k)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "226"
                        },
                        {
                            "builds": [],
                            "source": "        ts = datetime.utcnow().replace(microsecond=0).isoformat().replace(':', '-')",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "227"
                        },
                        {
                            "builds": [],
                            "source": "        params['time'] = ts",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "228"
                        },
                        {
                            "builds": [],
                            "source": "        params['start'] = self.start",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "229"
                        },
                        {
                            "builds": [],
                            "source": "        params['index'] = self.indexfmt.format(self.index)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "230"
                        },
                        {
                            "builds": [],
                            "source": "        self.index += 1",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "231"
                        },
                        {
                            "builds": [],
                            "source": "        self._uripar(params, spider)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "232"
                        },
                        {
                            "builds": [],
                            "source": "        return params",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": null,
                            "line": "233"
                        },
                        {
                            "builds": [],
                            "source": "",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "added",
                            "line": "234"
                        },
                        {
                            "builds": [],
                            "source": "    def _start_export(self, spider):",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "235"
                        },
                        {
                            "builds": [],
                            "source": "        uri = self.urifmt % self._get_uri_params(spider)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "236"
                        },
                        {
                            "builds": [],
                            "source": "        storage = self._get_storage(uri)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "237"
                        },
                        {
                            "builds": [],
                            "source": "        file = storage.open(spider)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "238"
                        },
                        {
                            "builds": [],
                            "source": "        exporter = self._get_exporter(file, fields_to_export=self.export_fields)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "239"
                        },
                        {
                            "builds": [],
                            "source": "        exporter.start_exporting()",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "240"
                        },
                        {
                            "builds": [],
                            "source": "        self.slot = SpiderSlot(file, exporter, storage, uri)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "241"
                        },
                        {
                            "builds": [],
                            "source": "",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "added",
                            "line": "242"
                        },
                        {
                            "builds": [],
                            "source": "    def _export(self, spider):",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "243"
                        },
                        {
                            "builds": [],
                            "source": "        slot = self.slot",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "244"
                        },
                        {
                            "builds": [],
                            "source": "        if not slot.itemcount and not self.store_empty:",
                            "coverage": "1/2",
                            "covered": "partial",
                            "message": null,
                            "type": "added",
                            "line": "245"
                        },
                        {
                            "builds": [],
                            "source": "            return",
                            "coverage": 0,
                            "covered": "miss",
                            "message": null,
                            "type": "added",
                            "line": "246"
                        },
                        {
                            "builds": [],
                            "source": "",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "added",
                            "line": "247"
                        },
                        {
                            "builds": [],
                            "source": "        # Export batch feed",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "added",
                            "line": "248"
                        },
                        {
                            "builds": [],
                            "source": "        slot.exporter.finish_exporting()",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "249"
                        },
                        {
                            "builds": [],
                            "source": "        logfmt = \"%s %%(format)s feed (%%(itemcount)d items) in: %%(uri)s\"",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "250"
                        },
                        {
                            "builds": [],
                            "source": "        log_args = {'format': self.format,",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "251"
                        },
                        {
                            "builds": [],
                            "source": "                    'itemcount': slot.itemcount,",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "added",
                            "line": "252"
                        },
                        {
                            "builds": [],
                            "source": "                    'uri': slot.uri}",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "added",
                            "line": "253"
                        },
                        {
                            "builds": [],
                            "source": "        d = defer.maybeDeferred(slot.storage.store, slot.file)",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "254"
                        },
                        {
                            "builds": [],
                            "source": "        d.addCallback(lambda _: logger.info(logfmt % \"Stored\", log_args,",
                            "coverage": "2/2",
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "255"
                        },
                        {
                            "builds": [],
                            "source": "                                            extra={'spider': spider}))",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "added",
                            "line": "256"
                        },
                        {
                            "builds": [],
                            "source": "        d.addErrback(lambda f: logger.error(logfmt % \"Error storing\", log_args,",
                            "coverage": "1/2",
                            "covered": "partial",
                            "message": null,
                            "type": "added",
                            "line": "257"
                        },
                        {
                            "builds": [],
                            "source": "                                            exc_info=failure_to_exc_info(f),",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "added",
                            "line": "258"
                        },
                        {
                            "builds": [],
                            "source": "                                            extra={'spider': spider}))",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": "added",
                            "line": "259"
                        },
                        {
                            "builds": [],
                            "source": "        return d",
                            "coverage": 1,
                            "covered": "hit",
                            "message": null,
                            "type": "added",
                            "line": "260"
                        },
                        {
                            "builds": [],
                            "source": " No newline at end of file",
                            "coverage": null,
                            "covered": null,
                            "message": null,
                            "type": null,
                            "line": "261"
                        }
                    ]
                }
            ],
            "type": "new",
            "before": "scrapy/extensions/feedexport.py"
        },
        "docs/topics/feed-exports.rst": {
            "type": "empty"
        },
        "tests/test_feedexport.py": {
            "type": "empty"
        }
    },
    "totals": {"hits": 27, "lines": 30, "partials": 2, "coverage": "90.00", "misses": 1}
}
